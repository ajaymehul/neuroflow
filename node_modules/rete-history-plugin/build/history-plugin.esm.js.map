{"version":3,"file":"history-plugin.esm.js","sources":["../src/history.js","../src/action.js","../src/actions/node.js","../src/actions/connection.js","../src/index.js"],"sourcesContent":["export default class History {\n    constructor() {\n        this.active = false;\n        this.produced = [];\n        this.reserved = [];\n    }\n\n    add(action) {\n        if(this.active) return;\n        this.produced.push(action);\n        this.reserved = [];\n    }\n\n    _do(from, to, type) {\n        const action = from.pop();\n        if(!action) return;\n\n        this.active = true;\n        action[type]();\n        to.push(action);\n        this.active = false;\n    }\n\n    undo() {\n        this._do(this.produced, this.reserved, 'undo');\n    }\n\n    redo() {\n        this._do(this.reserved, this.produced, 'redo');\n    }\n}","export default class Action {\n    undo() {}\n    redo() {}\n}","import Action from '../action';\n\nexport class AddNodeAction extends Action {\n    constructor(editor, node) {\n        super();\n        this.editor = editor;\n        this.node = node;\n    }\n    undo() {\n        this.editor.removeNode(this.node);\n    }\n    redo() {\n        this.editor.addNode(this.node);\n    }\n}\n\nexport class RemoveNodeAction extends Action {\n    constructor(editor, node) {\n        super();\n        this.editor = editor;\n        this.node = node;\n    }\n    undo() {\n        this.editor.addNode(this.node);\n    }\n    redo() {\n        this.editor.removeNode(this.node);\n    }\n}","import Action from '../action';\n\nfunction reassign(connection) {\n    const { input, output } = connection;\n\n    return output.connections.find(c => c.input === input);\n}\n\nexport class AddConnectionAction extends Action {\n    constructor(editor, connection) {\n        super();\n        this.editor = editor;\n        this.connection = connection;\n    }\n    undo() {\n        this.editor.removeConnection(this.connection);\n    }\n    redo() {\n        this.editor.connect(this.connection.output, this.connection.input);\n        this.connection = reassign(this.connection);\n    }\n}\n\nexport class RemoveConnectionAction extends Action {\n    constructor(editor, connection) {\n        super();\n        this.editor = editor;\n        this.connection = connection;\n    }\n    undo() {\n        this.editor.connect(output, input);\n        this.connection = reassign(this.connection);\n    }\n    redo() {\n        this.editor.removeConnection(this.connection);\n    }\n}\n","import History from './history';\nimport Action from './action';\nimport { AddNodeAction, RemoveNodeAction } from './actions/node';\nimport { AddConnectionAction, RemoveConnectionAction } from './actions/connection';\n\nfunction install(editor, { keyboard = true }) {\n    editor.bind('undo');\n    editor.bind('redo');\n    editor.bind('addhistory');\n\n    const history = new History();\n\n    editor.on('undo', () => history.undo());\n    editor.on('redo', () => history.redo());\n    editor.on('addhistory', action => history.add(action));\n\n    editor.on('nodecreated', node => history.add(new AddNodeAction(editor, node)));\n    editor.on('noderemoved', node => history.add(new RemoveNodeAction(editor, node)));\n    editor.on('connectioncreated', c => history.add(new AddConnectionAction(editor, c)));\n    editor.on('connectionremoved', c => history.add(new RemoveConnectionAction(editor, c)));\n\n    \n    if(keyboard) document.addEventListener('keydown', e => {\n        if(!e.ctrlKey) return;\n\n        switch(e.code) {\n            case 'KeyZ': editor.trigger('undo'); break;\n            case 'KeyY': editor.trigger('redo'); break;\n        }\n    });\n}\n\nexport default {\n    name: 'history',\n    install,\n    Action\n}"],"names":["History","active","produced","reserved","action","push","from","to","type","pop","_do","Action","AddNodeAction","editor","node","removeNode","addNode","RemoveNodeAction","reassign","connection","input","output","connections","find","c","AddConnectionAction","removeConnection","connect","RemoveConnectionAction","install","keyboard","bind","history","on","undo","redo","add","document","addEventListener","e","ctrlKey","code","trigger","name"],"mappings":"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"}