{"code":"!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=1)}([function(t,e,n){\"use strict\";\n/*!\n* rete v1.1.0 \n* (c) 2019 Ni55aN \n* Released under the MIT license.\n*/\nfunction r(t,e,n,r,o,i,s){try{var a=t[i](s),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function o(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var s=t.apply(e,n);function a(t){r(s,o,i,a,u,\"next\",t)}function u(t){r(s,o,i,a,u,\"throw\",t)}a(void 0)})}}function i(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);\"function\"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){u(t,e,n[e])})}return t}function l(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}function p(t,e){return!e||\"object\"!=typeof e&&\"function\"!=typeof e?f(t):e}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}(t,e)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}function m(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||\"[object Arguments]\"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}n.r(e),n.d(e,\"Component\",function(){return O}),n.d(e,\"Control\",function(){return g}),n.d(e,\"Emitter\",function(){return R}),n.d(e,\"Engine\",function(){return j}),n.d(e,\"Input\",function(){return x}),n.d(e,\"Node\",function(){return E}),n.d(e,\"NodeEditor\",function(){return Y}),n.d(e,\"Output\",function(){return C}),n.d(e,\"Socket\",function(){return b});var y=function(){function t(e){if(i(this,t),this.constructor===t)throw new TypeError(\"Can not construct abstract class.\");this.name=e,this.data={},this.engine=null}return a(t,[{key:\"worker\",value:function(){}}]),t}(),g=function(){function t(e){if(i(this,t),this.constructor===t)throw new TypeError(\"Can not construct abstract class\");if(!e)throw new Error(\"The key parameter is missing in super() of Control \");this.key=e,this.data={},this.parent=null}return a(t,[{key:\"getNode\",value:function(){if(null===this.parent)throw new Error(\"Control isn't added to Node/Input\");return this.parent instanceof E?this.parent:this.parent.node}},{key:\"getData\",value:function(t){return this.getNode().data[t]}},{key:\"putData\",value:function(t,e){this.getNode().data[t]=e}}]),t}(),k=function(){function t(e,n){i(this,t),this.output=e,this.input=n,this.data={},this.input.addConnection(this)}return a(t,[{key:\"remove\",value:function(){this.input.removeConnection(this),this.output.removeConnection(this)}}]),t}(),w=function(){function t(e,n,r,o){i(this,t),this.node=null,this.multipleConnections=o,this.connections=[],this.key=e,this.name=n,this.socket=r}return a(t,[{key:\"removeConnection\",value:function(t){this.connections.splice(this.connections.indexOf(t),1)}},{key:\"removeConnections\",value:function(){var t=this;this.connections.map(function(e){return t.removeConnection(e)})}}]),t}(),b=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t),this.name=e,this.data=n,this.compatible=[]}return a(t,[{key:\"combineWith\",value:function(t){this.compatible.push(t)}},{key:\"compatibleWith\",value:function(t){return this===t||this.compatible.includes(t)}}]),t}(),x=function(t){function e(t,n,r){var o,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i(this,e),(o=p(this,h(e).call(this,t,n,r,s))).control=null,o}return l(e,w),a(e,[{key:\"hasConnection\",value:function(){return this.connections.length>0}},{key:\"addConnection\",value:function(t){if(!this.multipleConnections&&this.hasConnection())throw new Error(\"Multiple connections not allowed\");this.connections.push(t)}},{key:\"addControl\",value:function(t){this.control=t,t.parent=this}},{key:\"showControl\",value:function(){return!this.hasConnection()&&null!==this.control}},{key:\"toJSON\",value:function(){return{connections:this.connections.map(function(t){return{node:t.output.node.id,output:t.output.key,data:t.data}})}}}]),e}(),C=function(t){function e(t,n,r){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return i(this,e),p(this,h(e).call(this,t,n,r,o))}return l(e,w),a(e,[{key:\"hasConnection\",value:function(){return this.connections.length>0}},{key:\"connectTo\",value:function(t){if(!this.socket.compatibleWith(t.socket))throw new Error(\"Sockets not compatible\");if(!t.multipleConnections&&t.hasConnection())throw new Error(\"Input already has one connection\");if(!this.multipleConnections&&this.hasConnection())throw new Error(\"Output already has one connection\");var e=new k(this,t);return this.connections.push(e),e}},{key:\"connectedTo\",value:function(t){return this.connections.some(function(e){return e.input===t})}},{key:\"toJSON\",value:function(){return{connections:this.connections.map(function(t){return{node:t.input.node.id,input:t.input.key,data:t.data}})}}}]),e}(),E=function(){function t(e){i(this,t),this.name=e,this.id=t.incrementId(),this.position=[0,0],this.inputs=new Map,this.outputs=new Map,this.controls=new Map,this.data={},this.meta={}}return a(t,[{key:\"addControl\",value:function(t){return t.parent=this,this.controls.set(t.key,t),this}},{key:\"removeControl\",value:function(t){t.parent=null,this.controls.delete(t.key)}},{key:\"addInput\",value:function(t){if(null!==t.node)throw new Error(\"Input has already been added to the node\");return t.node=this,this.inputs.set(t.key,t),this}},{key:\"removeInput\",value:function(t){t.removeConnections(),t.node=null,this.inputs.delete(t.key)}},{key:\"addOutput\",value:function(t){if(null!==t.node)throw new Error(\"Output has already been added to the node\");return t.node=this,this.outputs.set(t.key,t),this}},{key:\"removeOutput\",value:function(t){t.removeConnections(),t.node=null,this.outputs.delete(t.key)}},{key:\"getConnections\",value:function(){return[].concat(m(this.inputs.values()),m(this.outputs.values())).reduce(function(t,e){return[].concat(m(t),m(e.connections))},[])}},{key:\"update\",value:function(){}},{key:\"toJSON\",value:function(){return{id:this.id,data:this.data,inputs:Array.from(this.inputs).reduce(function(t,e){var n=v(e,2),r=n[0],o=n[1];return t[r]=o.toJSON(),t},{}),outputs:Array.from(this.outputs).reduce(function(t,e){var n=v(e,2),r=n[0],o=n[1];return t[r]=o.toJSON(),t},{}),position:this.position,name:this.name}}}],[{key:\"incrementId\",value:function(){return this.latestId?this.latestId++:this.latestId=1,this.latestId}},{key:\"resetId\",value:function(){this.latestId=0}},{key:\"fromJSON\",value:function(e){var n=new t(e.name);return n.id=e.id,n.data=e.data,n.position=e.position,n.name=e.name,t.latestId=Math.max(n.id,t.latestId),n}}]),t}(),O=function(t){function e(t){var n;if(i(this,e),(n=p(this,h(e).call(this,t))).constructor===e)throw new TypeError(\"Can not construct abstract class.\");return n.editor=null,n.data={},n}return l(e,y),a(e,[{key:\"builder\",value:function(){var t=o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case\"end\":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:\"build\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.builder(e);case 2:return t.abrupt(\"return\",e);case 3:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"createNode\",value:function(){var t=o(regeneratorRuntime.mark(function t(){var e,n,r=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},(n=new E(this.name)).data=e,t.next=5,this.build(n);case 5:return t.abrupt(\"return\",n);case 6:case\"end\":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),e}(),P=function t(e){i(this,t),this.handlers=c({warn:[console.warn],error:[console.error]},e)},R=function(){function t(e){i(this,t),this.events=e instanceof t?e.events:e.handlers,this.silent=!1}return a(t,[{key:\"on\",value:function(t,e){var n=this;return t.split(\" \").forEach(function(t){if(!n.events[t])throw new Error(\"The event \".concat(t,\" does not exist\"));n.events[t].push(e)}),this}},{key:\"trigger\",value:function(t,e){if(!(t in this.events))throw new Error(\"The event \".concat(t,\" cannot be triggered\"));return this.events[t].reduce(function(t,n){return!1!==n(e)&&t},!0)}},{key:\"bind\",value:function(t){if(this.events[t])throw new Error(\"The event \".concat(t,\" is already bound\"));this.events[t]=[]}},{key:\"exist\",value:function(t){return Array.isArray(this.events[t])}}]),t}(),S=function(){function t(){i(this,t)}return a(t,null,[{key:\"isValidData\",value:function(t){return\"string\"==typeof t.id&&this.isValidId(t.id)&&t.nodes instanceof Object&&!(t.nodes instanceof Array)}},{key:\"isValidId\",value:function(t){return/^[\\w-]{3,}@[0-9]+\\.[0-9]+\\.[0-9]+$/.test(t)}},{key:\"validate\",value:function(t,e){var n=\"\",r=t.split(\"@\"),o=e.id.split(\"@\");return this.isValidData(e)||(n+=\"Data is not suitable. \"),t!==e.id&&(n+=\"IDs not equal. \"),r[0]!==o[0]&&(n+=\"Names don't match. \"),r[1]!==o[1]&&(n+=\"Versions don't match\"),{success:\"\"===n,msg:n}}}]),t}(),N=function(t){function e(t,n){var r;if(i(this,e),r=p(this,h(e).call(this,n)),!S.isValidId(t))throw new Error(\"ID should be valid to name@0.1.0 format\");return r.id=t,r.plugins=new Map,r}return l(e,R),a(e,[{key:\"use\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.name&&this.plugins.has(t.name))throw new Error(\"Plugin \".concat(t.name,\" already in use\"));t.install(this,e),this.plugins.set(t.name,e)}}]),e}(),A=function(t){function e(){return i(this,e),p(this,h(e).call(this,{componentregister:[]}))}return l(e,P),e}(),I={AVALIABLE:0,PROCESSED:1,ABORT:2},j=function(t){function e(t){var n;return i(this,e),(n=p(this,h(e).call(this,t,new A))).components=[],n.args=[],n.data=null,n.state=I.AVALIABLE,n.onAbort=function(){},n}return l(e,N),a(e,[{key:\"clone\",value:function(){var t=new e(this.id);return this.components.map(function(e){return t.register(e)}),t}},{key:\"register\",value:function(t){this.components.push(t),this.trigger(\"componentregister\",t)}},{key:\"throwError\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,t.next=3,this.abort();case 3:return this.trigger(\"error\",{message:e,data:n}),this.processDone(),t.abrupt(\"return\",\"error\");case 6:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"extractInputNodes\",value:function(t,e){return Object.keys(t.inputs).reduce(function(n,r){return[].concat(m(n),m((t.inputs[r].connections||[]).reduce(function(t,n){return[].concat(m(t),[e[n.node]])},[])))},[])}},{key:\"detectRecursions\",value:function(t){var e=this,n=Object.keys(t).map(function(e){return t[e]});return n.map(function(n){return function n(r,o){if(o.some(function(t){return t===r}))return r;for(var i=0;i<o.length;i++)if(n(r,e.extractInputNodes(o[i],t)))return r;return null}(n,e.extractInputNodes(n,t))}).filter(function(t){return null!==t})}},{key:\"processStart\",value:function(){return this.state===I.AVALIABLE?(this.state=I.PROCESSED,!0):this.state!==I.ABORT&&(console.warn(\"The process is busy and has not been restarted.\\n                Use abort() to force it to complete\"),!1)}},{key:\"processDone\",value:function(){var t=this.state!==I.ABORT;return this.state=I.AVALIABLE,t||(this.onAbort(),this.onAbort=function(){}),t}},{key:\"abort\",value:function(){var t=o(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt(\"return\",new Promise(function(t){e.state===I.PROCESSED?(e.state=I.ABORT,e.onAbort=t):e.state===I.ABORT?(e.onAbort(),e.onAbort=t):t()}));case 1:case\"end\":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:\"lock\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt(\"return\",new Promise(function(t){e.unlockPool=e.unlockPool||[],e.busy&&!e.outputData?e.unlockPool.push(t):t(),e.busy=!0}));case 1:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"unlock\",value:function(t){t.unlockPool.forEach(function(t){return t()}),t.unlockPool=[],t.busy=!1}},{key:\"extractInputData\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r,i,s,a,u,c,l=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},r=Object.keys(e.inputs),i=0;case 3:if(!(i<r.length)){t.next=14;break}return s=r[i],a=e.inputs[s],u=a.connections,t.next=9,Promise.all(u.map(function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=l.data.nodes[e.node],t.next=3,l.processNode(n);case 3:if(r=t.sent){t.next=8;break}l.abort(),t.next=9;break;case 8:return t.abrupt(\"return\",r[e.output]);case 9:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()));case 9:c=t.sent,n[s]=c;case 11:i++,t.next=3;break;case 14:return t.abrupt(\"return\",n);case 15:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"processWorker\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extractInputData(e);case 2:return n=t.sent,r=this.components.find(function(t){return t.name===e.name}),o={},t.prev=5,t.next=8,r.worker.apply(r,[e,n,o].concat(m(this.args)));case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(5),this.abort(),this.trigger(\"warn\",t.t0);case 14:return t.abrupt(\"return\",o);case 15:case\"end\":return t.stop()}},t,this,[[5,10]])}));return function(e){return t.apply(this,arguments)}}()},{key:\"processNode\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==I.ABORT&&e){t.next=2;break}return t.abrupt(\"return\",null);case 2:return t.next=4,this.lock(e);case 4:return e.outputData||(e.outputData=this.processWorker(e)),this.unlock(e),t.abrupt(\"return\",e.outputData);case 7:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"forwardProcess\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==I.ABORT){t.next=2;break}return t.abrupt(\"return\",null);case 2:return t.next=4,Promise.all(Object.keys(e.outputs).map(function(){var t=o(regeneratorRuntime.mark(function t(r){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.outputs[r],t.next=3,Promise.all(i.connections.map(function(){var t=o(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.data.nodes[e.node],t.next=3,n.processNode(r);case 3:return t.next=5,n.forwardProcess(r);case 5:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()));case 3:return t.abrupt(\"return\",t.sent);case 4:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()));case 4:return t.abrupt(\"return\",t.sent);case 5:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"copy\",value:function(t){return(t=Object.assign({},t)).nodes=Object.assign({},t.nodes),Object.keys(t.nodes).forEach(function(e){t.nodes[e]=Object.assign({},t.nodes[e])}),t}},{key:\"validate\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((n=S.validate(this.id,e)).success){t.next=5;break}return t.next=4,this.throwError(n.msg);case 4:return t.abrupt(\"return\",t.sent);case 5:if(!((r=this.detectRecursions(e.nodes)).length>0)){t.next=10;break}return t.next=9,this.throwError(\"Recursion detected\",r);case 9:return t.abrupt(\"return\",t.sent);case 10:return t.abrupt(\"return\",!0);case 11:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"processStartNode\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=10;break}if(n=this.data.nodes[e]){t.next=6;break}return t.next=5,this.throwError(\"Node with such id not found\");case 5:return t.abrupt(\"return\",t.sent);case 6:return t.next=8,this.processNode(n);case 8:return t.next=10,this.forwardProcess(n);case 10:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:\"processUnreachable\",value:function(){var t=o(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=regeneratorRuntime.keys(this.data.nodes);case 1:if((t.t1=t.t0()).done){t.next=11;break}if(e=t.t1.value,void 0!==this.data.nodes[e].outputData){t.next=9;break}return n=this.data.nodes[e],t.next=7,this.processNode(n);case 7:return t.next=9,this.forwardProcess(n);case 9:t.next=1;break;case 11:case\"end\":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:\"process\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r,o,i,s=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:null,this.processStart()){t.next=3;break}return t.abrupt(\"return\");case 3:if(this.validate(e)){t.next=5;break}return t.abrupt(\"return\");case 5:for(this.data=this.copy(e),r=s.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=s[i];return this.args=o,t.next=10,this.processStartNode(n);case 10:return t.next=12,this.processUnreachable();case 12:return t.abrupt(\"return\",this.processDone()?\"success\":\"aborted\");case 13:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),e}(),D=function(t){function e(){return i(this,e),p(this,h(e).call(this,{nodecreate:[],nodecreated:[],noderemove:[],noderemoved:[],connectioncreate:[],connectioncreated:[],connectionremove:[],connectionremoved:[],translatenode:[],nodetranslate:[],nodetranslated:[],nodedraged:[],selectnode:[],nodeselect:[],nodeselected:[],rendernode:[],rendersocket:[],rendercontrol:[],renderconnection:[],updateconnection:[],componentregister:[],keydown:[],keyup:[],translate:[],translated:[],zoom:[],zoomed:[],click:[],mousemove:[],contextmenu:[],import:[],export:[],process:[]}))}return l(e,P),e}(),T=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};i(this,t),this.pointerStart=null,this.el=e,this.onTranslate=n,this.onStart=r,this.onDrag=o,this.initEvents(e)}return a(t,[{key:\"initEvents\",value:function(t){t.style.touchAction=\"none\",t.addEventListener(\"pointerdown\",this.down.bind(this)),window.addEventListener(\"pointermove\",this.move.bind(this)),window.addEventListener(\"pointerup\",this.up.bind(this))}},{key:\"down\",value:function(t){t.stopPropagation(),this.pointerStart=[t.pageX,t.pageY],this.onStart(t)}},{key:\"move\",value:function(t){if(this.pointerStart){t.preventDefault();var e=[t.pageX,t.pageY],n=e[1],r=[e[0]-this.pointerStart[0],n-this.pointerStart[1]],o=this.el.getBoundingClientRect().width/this.el.offsetWidth;this.onTranslate(r[0]/o,r[1]/o,t)}}},{key:\"up\",value:function(t){this.pointerStart&&(this.pointerStart=null,this.onDrag(t))}}]),t}(),_=function(){function t(e,n,r,o){i(this,t),this.el=n,this.intensity=r,this.onzoom=o,this.distance=null,e.addEventListener(\"wheel\",this.wheel.bind(this)),e.addEventListener(\"touchmove\",this.move.bind(this)),e.addEventListener(\"touchend\",this.end.bind(this)),e.addEventListener(\"touchcancel\",this.end.bind(this)),e.addEventListener(\"dblclick\",this.dblclick.bind(this))}return a(t,[{key:\"wheel\",value:function(t){t.preventDefault();var e=this.el.getBoundingClientRect(),n=(t.wheelDelta?t.wheelDelta/120:-t.deltaY/3)*this.intensity,r=(e.left-t.clientX)*n,o=(e.top-t.clientY)*n;this.onzoom(n,r,o,\"wheel\")}},{key:\"touches\",value:function(t){var e=[t.touches[0].clientX,t.touches[0].clientY],n=e[0],r=e[1],o=[t.touches[1].clientX,t.touches[1].clientY],i=o[0],s=o[1];return{cx:(n+i)/2,cy:(r+s)/2,distance:Math.sqrt(Math.pow(n-i,2)+Math.pow(r-s,2))}}},{key:\"move\",value:function(t){if(!(t.touches.length<2)){var e=this.el.getBoundingClientRect(),n=this.touches(t),r=n.cx,o=n.cy,i=n.distance;if(null!==this.distance){var s=i/this.distance-1,a=(e.left-r)*s,u=(e.top-o)*s;this.onzoom(s,a,u,\"touch\")}this.distance=i}}},{key:\"end\",value:function(){this.distance=null}},{key:\"dblclick\",value:function(t){t.preventDefault();var e=this.el.getBoundingClientRect(),n=4*this.intensity,r=(e.left-t.clientX)*n,o=(e.top-t.clientY)*n;this.onzoom(n,r,o,\"dblclick\")}}]),t}(),L=function(t){function e(t,n){var r;i(this,e);var o=(r=p(this,h(e).call(this,n))).el=document.createElement(\"div\");return r.container=t,r.transform={k:1,x:0,y:0},r.mouse={x:0,y:0},o.style.transformOrigin=\"0 0\",r._startPosition=null,r._zoom=new _(t,o,.1,r.onZoom.bind(f(f(r)))),r._drag=new T(t,r.onTranslate.bind(f(f(r))),r.onStart.bind(f(f(r)))),r.container.addEventListener(\"pointermove\",r.pointermove.bind(f(f(r)))),r.update(),r}return l(e,R),a(e,[{key:\"update\",value:function(){var t=this.transform;this.el.style.transform=\"translate(\".concat(t.x,\"px, \").concat(t.y,\"px) scale(\").concat(t.k,\")\")}},{key:\"pointermove\",value:function(t){var e=t.clientX,n=t.clientY,r=this.el.getBoundingClientRect(),o=e-r.left,i=n-r.top,s=this.transform.k;this.mouse={x:o/s,y:i/s},this.trigger(\"mousemove\",c({},this.mouse))}},{key:\"onStart\",value:function(){this._startPosition=c({},this.transform)}},{key:\"onTranslate\",value:function(t,e){this.translate(this._startPosition.x+t,this._startPosition.y+e)}},{key:\"onZoom\",value:function(t,e,n,r){this.zoom(this.transform.k*(1+t),e,n,r),this.update()}},{key:\"translate\",value:function(t,e){var n={transform:this.transform,x:t,y:e};this.trigger(\"translate\",n)&&(this.transform.x=n.x,this.transform.y=n.y,this.update(),this.trigger(\"translated\"))}},{key:\"zoom\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=this.transform.k,i={transform:this.transform,zoom:t,source:r};if(this.trigger(\"zoom\",i)){var s=(o-i.zoom)/(o-t||1);this.transform.k=i.zoom||1,this.transform.x+=e*s,this.transform.y+=n*s,this.update(),this.trigger(\"zoomed\",{source:r})}}},{key:\"appendChild\",value:function(t){this.el.appendChild(t)}},{key:\"removeChild\",value:function(t){this.el.removeChild(t)}}]),e}(),M=function(t){function e(t,n,r){var o;return i(this,e),(o=p(this,h(e).call(this,r))).trigger(\"rendercontrol\",{el:t,control:n}),o}return l(e,R),e}(),z=function(t){function e(t,n,r,o,s){var a,c;return i(this,e),(c=p(this,h(e).call(this,s))).el=t,c.type=n,c.io=r,c.node=o,c.trigger(\"rendersocket\",(u(a={el:t},n,c.io),u(a,\"socket\",r.socket),a)),c}return l(e,R),a(e,[{key:\"getPosition\",value:function(t){var e=t.position,n=this.el;return[e[0]+n.offsetLeft+n.offsetWidth/2,e[1]+n.offsetTop+n.offsetHeight/2]}}]),e}(),B=function(t){function e(t,n,r){var o;return i(this,e),(o=p(this,h(e).call(this,r))).node=t,o.component=n,o.sockets=new Map,o.controls=new Map,o.el=document.createElement(\"div\"),o.el.style.position=\"absolute\",o.el.addEventListener(\"contextmenu\",function(t){return o.trigger(\"contextmenu\",{e:t,node:o.node})}),o._startPosition=null,o._drag=new T(o.el,o.onTranslate.bind(f(f(o))),o.onSelect.bind(f(f(o))),function(){o.trigger(\"nodedraged\",t)}),o.trigger(\"rendernode\",{el:o.el,node:t,component:n.data,bindSocket:o.bindSocket.bind(f(f(o))),bindControl:o.bindControl.bind(f(f(o)))}),o.update(),o}return l(e,R),a(e,[{key:\"bindSocket\",value:function(t,e,n){this.sockets.set(n,new z(t,e,n,this.node,this))}},{key:\"bindControl\",value:function(t,e){this.controls.set(e,new M(t,e,this))}},{key:\"getSocketPosition\",value:function(t){return this.sockets.get(t).getPosition(this.node)}},{key:\"onSelect\",value:function(t){this.onStart(),this.trigger(\"selectnode\",{node:this.node,accumulate:t.ctrlKey})}},{key:\"onStart\",value:function(){this._startPosition=m(this.node.position)}},{key:\"onTranslate\",value:function(t,e){this.trigger(\"translatenode\",{node:this.node,dx:t,dy:e})}},{key:\"onDrag\",value:function(t,e){var n=this._startPosition[0]+t,r=this._startPosition[1]+e;this.translate(n,r)}},{key:\"translate\",value:function(t,e){var n=this.node,r={node:n,x:t,y:e};if(this.trigger(\"nodetranslate\",r)){var o=m(n.position);n.position[0]=r.x,n.position[1]=r.y,this.update(),this.trigger(\"nodetranslated\",{node:n,prev:o})}}},{key:\"update\",value:function(){this.el.style.transform=\"translate(\".concat(this.node.position[0],\"px, \").concat(this.node.position[1],\"px)\")}},{key:\"remove\",value:function(){}}]),e}(),J=function(t){function e(t,n,r,o){var s;return i(this,e),(s=p(this,h(e).call(this,o))).connection=t,s.inputNode=n,s.outputNode=r,s.el=document.createElement(\"div\"),s.el.style.position=\"absolute\",s.el.style.zIndex=\"-1\",s.trigger(\"renderconnection\",{el:s.el,connection:s.connection,points:s.getPoints()}),s}return l(e,R),a(e,[{key:\"getPoints\",value:function(){var t=v(this.outputNode.getSocketPosition(this.connection.output),2),e=t[0],n=t[1],r=v(this.inputNode.getSocketPosition(this.connection.input),2);return[e,n,r[0],r[1]]}},{key:\"update\",value:function(){this.trigger(\"updateconnection\",{el:this.el,connection:this.connection,points:this.getPoints()})}}]),e}(),V=function(t){function e(t,n,r){var o;return i(this,e),(o=p(this,h(e).call(this,r))).container=t,o.components=n,o.container.style.overflow=\"hidden\",o.nodes=new Map,o.connections=new Map,o.container.addEventListener(\"click\",o.click.bind(f(f(o)))),o.container.addEventListener(\"contextmenu\",function(t){return o.trigger(\"contextmenu\",{e:t,view:f(f(o))})}),window.addEventListener(\"resize\",o.resize.bind(f(f(o)))),o.on(\"nodetranslated\",o.updateConnections.bind(f(f(o)))),o.area=new L(t,f(f(o))),o.container.appendChild(o.area.el),o}return l(e,R),a(e,[{key:\"addNode\",value:function(t){var e=new B(t,this.components.get(t.name),this);this.nodes.set(t,e),this.area.appendChild(e.el)}},{key:\"removeNode\",value:function(t){var e=this.nodes.get(t);this.nodes.delete(t),this.area.removeChild(e.el)}},{key:\"addConnection\",value:function(t){var e=this.nodes.get(t.input.node),n=this.nodes.get(t.output.node),r=new J(t,e,n,this);this.connections.set(t,r),this.area.appendChild(r.el)}},{key:\"removeConnection\",value:function(t){var e=this.connections.get(t);this.connections.delete(t),this.area.removeChild(e.el)}},{key:\"updateConnections\",value:function(t){var e=this;t.node.getConnections().map(function(t){e.connections.get(t).update()})}},{key:\"resize\",value:function(){var t=this.container,e=t.parentElement.clientWidth,n=t.parentElement.clientHeight;t.style.width=e+\"px\",t.style.height=n+\"px\"}},{key:\"click\",value:function(t){var e=this.container;e===t.target&&this.trigger(\"click\",{e:t,container:e})}}]),e}(),W=function(){function t(){i(this,t),this.list=[]}return a(t,[{key:\"add\",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.contains(t)||this.list.push(t):this.list=[t]}},{key:\"clear\",value:function(){this.list=[]}},{key:\"remove\",value:function(t){this.list.splice(this.list.indexOf(t),1)}},{key:\"contains\",value:function(t){return-1!==this.list.indexOf(t)}},{key:\"each\",value:function(t){this.list.forEach(t)}}]),t}(),Y=function(t){function e(t,n){var r;return i(this,e),(r=p(this,h(e).call(this,t,new D))).nodes=[],r.components=new Map,r.selected=new W,r.view=new V(n,r.components,f(f(r))),window.addEventListener(\"keydown\",function(t){return r.trigger(\"keydown\",t)}),window.addEventListener(\"keyup\",function(t){return r.trigger(\"keyup\",t)}),r.on(\"selectnode\",function(t){var e=t.node,n=t.accumulate;return r.selectNode(e,n)}),r.on(\"nodeselected\",function(){return r.selected.each(function(t){return r.view.nodes.get(t).onStart()})}),r.on(\"translatenode\",function(t){var e=t.dx,n=t.dy;return r.selected.each(function(t){return r.view.nodes.get(t).onDrag(e,n)})}),r}return l(e,N),a(e,[{key:\"addNode\",value:function(t){this.trigger(\"nodecreate\",t)&&(this.nodes.push(t),this.view.addNode(t),this.trigger(\"nodecreated\",t))}},{key:\"removeNode\",value:function(t){var e=this;this.trigger(\"noderemove\",t)&&(t.getConnections().forEach(function(t){return e.removeConnection(t)}),this.nodes.splice(this.nodes.indexOf(t),1),this.view.removeNode(t),this.trigger(\"noderemoved\",t))}},{key:\"connect\",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.trigger(\"connectioncreate\",{output:t,input:e}))try{var r=t.connectTo(e);r.data=n,this.view.addConnection(r),this.trigger(\"connectioncreated\",r)}catch(t){this.trigger(\"warn\",t)}}},{key:\"removeConnection\",value:function(t){this.trigger(\"connectionremove\",t)&&(this.view.removeConnection(t),t.remove(),this.trigger(\"connectionremoved\",t))}},{key:\"selectNode\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(-1===this.nodes.indexOf(t))throw new Error(\"Node not exist in list\");this.trigger(\"nodeselect\",t)&&(this.selected.add(t,e),this.trigger(\"nodeselected\",t))}},{key:\"getComponent\",value:function(t){var e=this.components.get(t);if(!e)throw\"Component \".concat(t,\" not found\");return e}},{key:\"register\",value:function(t){t.editor=this,this.components.set(t.name,t),this.trigger(\"componentregister\",t)}},{key:\"clear\",value:function(){var t=this;m(this.nodes).map(function(e){return t.removeNode(e)})}},{key:\"toJSON\",value:function(){var t={id:this.id,nodes:{}};return this.nodes.forEach(function(e){return t.nodes[e.id]=e.toJSON()}),this.trigger(\"export\",t),t}},{key:\"beforeImport\",value:function(t){var e=S.validate(this.id,t);return e.success?(this.silent=!0,this.clear(),this.trigger(\"import\",t),!0):(this.trigger(\"warn\",e.msg),!1)}},{key:\"afterImport\",value:function(){return this.silent=!1,!0}},{key:\"fromJSON\",value:function(){var t=o(regeneratorRuntime.mark(function t(e){var n,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.beforeImport(e)){t.next=2;break}return t.abrupt(\"return\",!1);case 2:return n={},t.prev=3,t.next=6,Promise.all(Object.keys(e.nodes).map(function(){var t=o(regeneratorRuntime.mark(function t(o){var i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.nodes[o],s=r.getComponent(i.name),t.next=4,s.build(E.fromJSON(i));case 4:n[o]=t.sent,r.addNode(n[o]);case 6:case\"end\":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()));case 6:Object.keys(e.nodes).forEach(function(t){var o=e.nodes[t],i=n[t];Object.keys(o.outputs).forEach(function(t){o.outputs[t].connections.forEach(function(e){var o=e.node,s=e.data,a=i.outputs.get(t),u=n[o].inputs.get(e.input);r.connect(a,u,s)})})}),t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),this.trigger(\"warn\",t.t0),t.abrupt(\"return\",!this.afterImport());case 13:return t.prev=13,t.abrupt(\"return\",this.afterImport());case 16:case\"end\":return t.stop()}},t,this,[[3,9,13,16]])}));return function(e){return t.apply(this,arguments)}}()}]),e}(),X={Component:O,Control:g,Emitter:R,Engine:j,Input:x,Node:E,NodeEditor:Y,Output:C,Socket:b};e.default=X},function(t,e,n){var r=n(0),o=n(2),i=(async()=>{var t=document.querySelector(\"#rete\"),e=[new o],n=new r.NodeEditor(\"demo@0.1.0\",t);n.use(ConnectionPlugin),n.use(VueRenderPlugin),n.use(ContextMenuPlugin),n.use(AreaPlugin),n.use(CommentPlugin),n.use(HistoryPlugin);var s=new r.Engine(\"demo@0.1.0\");e.map(t=>{n.register(t),s.register(t)});var a=await e[0].createNode({arr1:[],arr2:[],arr3:[],arr4:[]});i.n1=a,a.position=[80,200],n.addNode(a),n.on(\"process nodecreated noderemoved connectioncreated connectionremoved\",async()=>{console.log(\"process\"),await s.abort(),await s.process(n.toJSON())}),n.view.resize(),AreaPlugin.zoomAt(n),n.trigger(\"process\")})()},function(t,e,n){var r=n(0),o=n(3),i=n(4);t.exports={MuseComponent:class extends r.Component{constructor(){super(\"Muse Device\")}builder(t){var e=new(0,i.Array),n=new(0,i.Array),r=new(0,i.Array),s=new(0,socket.Array);return t.addControl(new o(this.editor,\"arr1\")).addControl(new o(this.editor,\"arr2\")).addControl(new o(this.editor,\"arr3\")).addControl(new o(this.editor,\"arr4\")).addOutput(e).addOutput(n).addOutput(r).addOutput(s)}worker(t,e,n){n.arr1=t.data.arr1,n.arr2=t.data.arr2,n.arr3=t.data.arr3,n.arr4=t.data.arr4}}}},function(t,e,n){var r=n(0),o={props:[\"readonly\",\"emitter\",\"ikey\",\"getData\",\"putData\"],data:()=>({buffer:[]}),methods:{push_sample(t){buffer.length>1e3&&buffer.shift(),buffer.push(t),buffer.length<1e3||this.update()},update(){this.emitter.trigger(\"process\")}},mounted(){this.buffer=this.getData(this.ikey)}};t.exports=class extends r.Control{constructor(t,e,n){super(e),this.component=o,this.props={emitter:t,ikey:e,readonly:n}}push_sample(t){this.vueContext.push_sample(t)}}},function(t,e,n){var r=new(n(0).Socket)(\"Array\");t.exports={Array:r}}]);","extractedComments":[]}