{"version":3,"file":"context-menu-plugin.debug.js","sources":["../src/utils.js","../src/debounceHide.js","../src/Item.vue","../src/Search.vue","../src/Menu.vue","../src/Menu.js","../src/index.js"],"sourcesContent":["export function deepCopy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\n\nexport async function createNode(component, { data = {}, meta = {}, x = 0, y = 0 }) {\n    const node = await component.createNode(deepCopy(data));\n\n    node.meta = deepCopy(meta);\n    node.position[0] = x;\n    node.position[1] = y;\n    \n    return node;\n}\n\nexport function traverse(items, callback, path = []) {\n    if (typeof items !== 'object') return;\n\n    Object.keys(items).map(key => {\n        if (typeof items[key] === 'function')\n            callback(key, items[key], path)\n        else \n            traverse(items[key], callback, [...path, key])\n    })\n}\n\nexport function fitViewport([x, y], element) {\n    return [\n        Math.min(x, window.innerWidth - element.clientWidth),\n        Math.min(y, window.innerHeight - element.clientHeight)\n    ]\n}","import { debounce } from 'lodash';\n\nexport default (hideMethod) => ({\n    props: { delay: { type: Number, required: true } },\n    data() {\n        return {\n            timeoutHide: () => {}\n        }\n    },\n    methods: {\n        cancelHide() {\n            const hide = this.timeoutHide;\n    \n            if (hide && hide.cancel)\n                this.timeoutHide.cancel();\n        }\n    },\n    mounted() {\n        this.timeoutHide = debounce(this[hideMethod], this.delay);\n    }\n})","<template lang=\"pug\">\n.item(\n  @click=\"onClick($event)\"\n  @mouseover=\"showSubitems()\"\n  @mouseleave=\"timeoutHide()\"\n  :class=\"{ hasSubitems }\"\n) {{item.title}}\n  .subitems(v-show=\"hasSubitems && this.visibleSubitems\")\n    Item(v-for=\"subitem in item.subitems\"\n      :key=\"subitem.title\"\n      :item=\"subitem\"\n      :args=\"args\"\n      :delay=\"delay\"\n      )\n</template>\n\n<script>\nimport hideMixin from './debounceHide'\n\nexport default {\n  name: 'Item',\n  mixins: [hideMixin('hideSubitems')],\n  props: { item: Object, args: Object },\n  data() {\n    return {\n      visibleSubitems: false, \n    }\n  },\n  computed: {\n    hasSubitems() {\n      return this.item.subitems\n    }\n  },\n  methods: {\n    showSubitems() {\n      this.visibleSubitems = true;\n      this.cancelHide();\n    },\n    hideSubitems() {\n      this.visibleSubitems = false;\n    },\n    onClick(e) {\n      e.stopPropagation();\n      \n      if(this.item.onClick)\n        this.item.onClick(this.args);\n      this.$root.$emit('hide');\n    }\n  }\n}\n</script>\n\n\n<style lang=\"sass\" scoped>\n@import './vars.sass'\n@import './common.sass'\n\n.item\n  @extend .item\n  &.hasSubitems:after\n    content: 'â–º'\n    position: absolute\n    opacity: 0.6\n    right: 5px\n    top: 5px\n  .subitems\n    position: absolute\n    top: 0\n    left: 100%\n    width: $width\n    .subitem\n      @extend .item\n</style>\n","<template lang=\"pug\">\n.search\n  input(v-model=\"value\")\n</template>\n\n<script>\nexport default {\n  props: ['search'],\n  data() {\n    return {\n      value: ''\n    }\n  },\n  watch: {\n    value() {\n      this.$emit('search', this.value);\n    }\n  }\n}\n</script>\n\n\n<style lang=\"sass\" scoped>\n.search\n  input    \n    color: white\n    padding: 1px 8px\n    border: 1px solid white\n    border-radius: 10px\n    font-size: 16px\n    font-family: serif\n    width: 100%\n    box-sizing: border-box\n    background: transparent\n</style>\n","<template lang=\"pug\">\n.context-menu(\n  ref=\"menu\"\n  v-if=\"visible\"\n  v-bind:style=\"style\",\n  @mouseleave='timeoutHide()',\n  @mouseover=\"cancelHide()\"\n  @contextmenu.prevent=\"\"\n)\n  Search(v-if=\"searchBar\", @search=\"onSearch\")\n  Item(v-for='item in filtered'\n    :key=\"item.title\"\n    :item=\"item\"\n    :args=\"args\"\n    :delay=\"delay / 2\"\n  )\n</template>\n\n<script>\nimport hideMixin from './debounceHide'\nimport Item from './Item.vue';\nimport Search from './Search.vue';\nimport { fitViewport } from './utils';\n\nexport default {\n  props: { searchBar: Boolean },\n  mixins: [hideMixin('hide')],\n  data() {\n    return {\n      x: 0,\n      y: 0,\n      visible: false,\n      args: {},\n      filter: '',\n      items: [],\n    }\n  },\n  computed: {\n    style() {\n      return {\n        top: this.y+'px', \n        left: this.x+'px'\n      }\n    },\n    filtered() {\n      if(!this.filter) return this.items;\n      \n      return this.extractLeafs(this.items)\n        .filter(i => i.title.toLowerCase()\n          .includes(this.filter.toLowerCase())\n        );\n    }\n  },\n  methods: {\n    extractLeafs(items) {\n      if(!items) return [];\n      let leafs = [];\n      items.map(item => {\n        if(!item.subitems) leafs.push(item)\n\n        leafs.push(...this.extractLeafs(item.subitems))\n      })\n\n      return leafs;\n    },\n    onSearch(e) {\n      this.filter = e;\n    },\n    show(x, y, args = {}) {\n      this.visible = true;\n      this.x = x;\n      this.y = y;\n      this.args = args;\n  \n      this.cancelHide();\n    },\n    hide() {\n      this.visible = false;\n    },\n    additem(title, onClick, path = []) {\n      let items = this.items;\n      for(let level of path) {\n        let exist = items.find(i => i.title === level);\n\n        if(!exist) {\n          exist = { title: level, subitems: [] };\n          items.push(exist)\n        }\n\n        items = exist.subitems || (exist.subitems = []);\n      }\n\n      items.push({ title, onClick });\n    },\n  },\n  updated() {\n    if(this.$refs.menu) {\n      [this.x, this.y] = fitViewport([this.x, this.y], this.$refs.menu)\n    } \n  },\n  mounted() {\n    this.$root.$on('show', this.show);\n    this.$root.$on('hide', this.hide);\n    this.$root.$on('additem', this.additem);\n  },\n  components: {\n    Item,\n    Search\n  }\n}\n</script>\n\n\n<style lang=\"sass\" scoped>\n@import './vars.sass'\n@import './common.sass'\n\n.context-menu\n  left: 0\n  top: 0\n  position: fixed\n  padding: 10px\n  width: $width\n  margin-top: -20px\n  margin-left: -$width/2\n  .search\n    @extend .item\n</style>\n","import Menu from './Menu.vue';\nimport Vue from 'vue';\n\nexport default class {\n    \n    constructor(editor, props) {\n        const el = document.createElement('div');\n\n        editor.view.container.appendChild(el);\n\n        this.menu = new Vue({\n            render: h => h(Menu, { props })\n        }).$mount(el);\n    }\n\n    addItem(...args) {\n        this.menu.$emit('additem', ...args);\n    }\n\n    show(...args) {\n        this.menu.$emit('show', ...args);\n    }\n\n    hide() {\n        this.menu.$emit('hide');\n    }\n}","import { createNode, traverse } from './utils';\nimport Menu from './Menu';\n\nfunction configureNodeItems(menu, editor) {\n    menu.addItem('Delete', ({ node }) => editor.removeNode(node));\n    menu.addItem('Clone', async (args) => {\n        const { name, position: [x, y], ...params } = args.node;\n        const component = editor.components.get(name);\n\n        editor.addNode(await createNode(component, { ...params, x: x + 10, y: y + 10 }));\n    });\n} \n\nfunction configureMainItems(menu, editor, { items, allocate, rename }) {\n    const mouse = { x: 0, y: 0 };\n\n    editor.on('mousemove', ({ x, y }) => {\n        mouse.x = x;\n        mouse.y = y;\n    });\n    \n    editor.on('componentregister', component => {\n        const path = allocate(component);\n\n        if (Array.isArray(path)) // add to the menu if path is array\n            menu.addItem(rename(component), async () => {\n                editor.addNode(await createNode(component, mouse));\n            },\n            path);\n    });\n\n    traverse(items, (name, func, path) => menu.addItem(name, func, path))\n}\n\nfunction install(editor, { \n    searchBar = true,\n    delay = 1000,\n    items = {},\n    allocate = () => [],\n    rename = component => component.name\n}) {\n    editor.bind('hidecontextmenu');\n\n    const menu = new Menu(editor, { searchBar, delay });\n    const nodeMenu = new Menu(editor, { searchBar: false, delay });\n\n    configureNodeItems(nodeMenu, editor);\n    configureMainItems(menu, editor, { items, allocate, rename });\n\n    editor.on('hidecontextmenu', () => {\n        menu.hide();\n        nodeMenu.hide();\n    });\n\n    editor.on('click contextmenu', () => {\n        editor.trigger('hidecontextmenu');\n    });\n\n    editor.on('contextmenu', ({ e, node }) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const [x, y] = [e.clientX, e.clientY];\n\n        if (node) {\n            nodeMenu.show(x, y, { node });\n        } else {\n            menu.show(x, y);\n        }\n    });\n}\n\nexport default {\n    name: 'context-menu',\n    install\n}"],"names":["deepCopy","obj","JSON","parse","stringify","createNode","component","data","meta","x","y","node","position","traverse","items","callback","path","Object","keys","map","key","fitViewport","element","Math","min","window","innerWidth","clientWidth","innerHeight","clientHeight","hideMethod","props","delay","type","Number","required","timeoutHide","methods","cancelHide","hide","cancel","mounted","debounce","constructor","editor","el","document","createElement","view","container","appendChild","menu","Vue","render","h","Menu","$mount","addItem","args","$emit","show","configureNodeItems","removeNode","name","params","components","get","addNode","configureMainItems","allocate","rename","mouse","on","Array","isArray","func","install","searchBar","bind","nodeMenu","trigger","e","preventDefault","stopPropagation","clientX","clientY"],"mappings":"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"}