{"version":3,"file":"context-menu-plugin.min.js","sources":["../src/utils.js","../src/debounceHide.js","../src/Menu.vue","../src/Menu.js","../src/index.js"],"sourcesContent":["export function deepCopy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\n\nexport async function createNode(component, { data = {}, meta = {}, x = 0, y = 0 }) {\n    const node = await component.createNode(deepCopy(data));\n\n    node.meta = deepCopy(meta);\n    node.position[0] = x;\n    node.position[1] = y;\n    \n    return node;\n}\n\nexport function traverse(items, callback, path = []) {\n    if (typeof items !== 'object') return;\n\n    Object.keys(items).map(key => {\n        if (typeof items[key] === 'function')\n            callback(key, items[key], path)\n        else \n            traverse(items[key], callback, [...path, key])\n    })\n}\n\nexport function fitViewport([x, y], element) {\n    return [\n        Math.min(x, window.innerWidth - element.clientWidth),\n        Math.min(y, window.innerHeight - element.clientHeight)\n    ]\n}","import { debounce } from 'lodash';\n\nexport default (hideMethod) => ({\n    props: { delay: { type: Number, required: true } },\n    data() {\n        return {\n            timeoutHide: () => {}\n        }\n    },\n    methods: {\n        cancelHide() {\n            const hide = this.timeoutHide;\n    \n            if (hide && hide.cancel)\n                this.timeoutHide.cancel();\n        }\n    },\n    mounted() {\n        this.timeoutHide = debounce(this[hideMethod], this.delay);\n    }\n})","<template lang=\"pug\">\n.context-menu(\n  ref=\"menu\"\n  v-if=\"visible\"\n  v-bind:style=\"style\",\n  @mouseleave='timeoutHide()',\n  @mouseover=\"cancelHide()\"\n  @contextmenu.prevent=\"\"\n)\n  Search(v-if=\"searchBar\", @search=\"onSearch\")\n  Item(v-for='item in filtered'\n    :key=\"item.title\"\n    :item=\"item\"\n    :args=\"args\"\n    :delay=\"delay / 2\"\n  )\n</template>\n\n<script>\nimport hideMixin from './debounceHide'\nimport Item from './Item.vue';\nimport Search from './Search.vue';\nimport { fitViewport } from './utils';\n\nexport default {\n  props: { searchBar: Boolean },\n  mixins: [hideMixin('hide')],\n  data() {\n    return {\n      x: 0,\n      y: 0,\n      visible: false,\n      args: {},\n      filter: '',\n      items: [],\n    }\n  },\n  computed: {\n    style() {\n      return {\n        top: this.y+'px', \n        left: this.x+'px'\n      }\n    },\n    filtered() {\n      if(!this.filter) return this.items;\n      \n      return this.extractLeafs(this.items)\n        .filter(i => i.title.toLowerCase()\n          .includes(this.filter.toLowerCase())\n        );\n    }\n  },\n  methods: {\n    extractLeafs(items) {\n      if(!items) return [];\n      let leafs = [];\n      items.map(item => {\n        if(!item.subitems) leafs.push(item)\n\n        leafs.push(...this.extractLeafs(item.subitems))\n      })\n\n      return leafs;\n    },\n    onSearch(e) {\n      this.filter = e;\n    },\n    show(x, y, args = {}) {\n      this.visible = true;\n      this.x = x;\n      this.y = y;\n      this.args = args;\n  \n      this.cancelHide();\n    },\n    hide() {\n      this.visible = false;\n    },\n    additem(title, onClick, path = []) {\n      let items = this.items;\n      for(let level of path) {\n        let exist = items.find(i => i.title === level);\n\n        if(!exist) {\n          exist = { title: level, subitems: [] };\n          items.push(exist)\n        }\n\n        items = exist.subitems || (exist.subitems = []);\n      }\n\n      items.push({ title, onClick });\n    },\n  },\n  updated() {\n    if(this.$refs.menu) {\n      [this.x, this.y] = fitViewport([this.x, this.y], this.$refs.menu)\n    } \n  },\n  mounted() {\n    this.$root.$on('show', this.show);\n    this.$root.$on('hide', this.hide);\n    this.$root.$on('additem', this.additem);\n  },\n  components: {\n    Item,\n    Search\n  }\n}\n</script>\n\n\n<style lang=\"sass\" scoped>\n@import './vars.sass'\n@import './common.sass'\n\n.context-menu\n  left: 0\n  top: 0\n  position: fixed\n  padding: 10px\n  width: $width\n  margin-top: -20px\n  margin-left: -$width/2\n  .search\n    @extend .item\n</style>\n","import Menu from './Menu.vue';\nimport Vue from 'vue';\n\nexport default class {\n    \n    constructor(editor, props) {\n        const el = document.createElement('div');\n\n        editor.view.container.appendChild(el);\n\n        this.menu = new Vue({\n            render: h => h(Menu, { props })\n        }).$mount(el);\n    }\n\n    addItem(...args) {\n        this.menu.$emit('additem', ...args);\n    }\n\n    show(...args) {\n        this.menu.$emit('show', ...args);\n    }\n\n    hide() {\n        this.menu.$emit('hide');\n    }\n}","import { createNode, traverse } from './utils';\nimport Menu from './Menu';\n\nfunction configureNodeItems(menu, editor) {\n    menu.addItem('Delete', ({ node }) => editor.removeNode(node));\n    menu.addItem('Clone', async (args) => {\n        const { name, position: [x, y], ...params } = args.node;\n        const component = editor.components.get(name);\n\n        editor.addNode(await createNode(component, { ...params, x: x + 10, y: y + 10 }));\n    });\n} \n\nfunction configureMainItems(menu, editor, { items, allocate, rename }) {\n    const mouse = { x: 0, y: 0 };\n\n    editor.on('mousemove', ({ x, y }) => {\n        mouse.x = x;\n        mouse.y = y;\n    });\n    \n    editor.on('componentregister', component => {\n        const path = allocate(component);\n\n        if (Array.isArray(path)) // add to the menu if path is array\n            menu.addItem(rename(component), async () => {\n                editor.addNode(await createNode(component, mouse));\n            },\n            path);\n    });\n\n    traverse(items, (name, func, path) => menu.addItem(name, func, path))\n}\n\nfunction install(editor, { \n    searchBar = true,\n    delay = 1000,\n    items = {},\n    allocate = () => [],\n    rename = component => component.name\n}) {\n    editor.bind('hidecontextmenu');\n\n    const menu = new Menu(editor, { searchBar, delay });\n    const nodeMenu = new Menu(editor, { searchBar: false, delay });\n\n    configureNodeItems(nodeMenu, editor);\n    configureMainItems(menu, editor, { items, allocate, rename });\n\n    editor.on('hidecontextmenu', () => {\n        menu.hide();\n        nodeMenu.hide();\n    });\n\n    editor.on('click contextmenu', () => {\n        editor.trigger('hidecontextmenu');\n    });\n\n    editor.on('contextmenu', ({ e, node }) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const [x, y] = [e.clientX, e.clientY];\n\n        if (node) {\n            nodeMenu.show(x, y, { node });\n        } else {\n            menu.show(x, y);\n        }\n    });\n}\n\nexport default {\n    name: 'context-menu',\n    install\n}"],"names":["deepCopy","obj","JSON","parse","stringify","component","data","meta","x","y","createNode","position","node","hideMethod","delay","type","Number","required","hide","this","timeoutHide","cancel","debounce","element","Math","min","window","innerWidth","clientWidth","innerHeight","clientHeight","editor","props","el","document","createElement","view","container","appendChild","menu","Vue","h","Menu","$mount","args","$emit","configureMainItems","items","allocate","rename","mouse","on","path","Array","isArray","addItem","addNode","traverse","callback","keys","map","key","name","func","searchBar","bind","nodeMenu","removeNode","params","components","get","trigger","e","preventDefault","stopPropagation","clientX","clientY","show"],"mappings":"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"}